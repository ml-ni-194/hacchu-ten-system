<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åœ¨åº«ç®¡ç†ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background-color: #f5f5f5;
            color: #333;
        }

        .header {
            background: linear-gradient(135deg, #2c3e50, #3498db);
            color: white;
            padding: 1rem 0;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .header-content {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            font-size: 1.5rem;
            font-weight: bold;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        /* è¨­å®šãƒ‘ãƒãƒ« */
        .settings-panel {
            background: white;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .settings-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .setting-group {
            display: flex;
            flex-direction: column;
        }

        .setting-group label {
            font-weight: bold;
            margin-bottom: 5px;
            color: #2c3e50;
        }

        .setting-group input,
        .setting-group select {
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 14px;
        }

        .btn {
            background: #3498db;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            transition: background 0.3s;
        }

        .btn:hover {
            background: #2980b9;
        }

        .btn:disabled {
            background: #bdc3c7;
            cursor: not-allowed;
        }

        .btn-danger {
            background: #e74c3c;
        }

        .btn-danger:hover {
            background: #c0392b;
        }

        .btn-success {
            background: #27ae60;
        }

        .btn-success:hover {
            background: #219a52;
        }

        .btn-warning {
            background: #f39c12;
            color: white;
        }

        .btn-warning:hover {
            background: #e67e22;
        }

        /* ã‚µãƒãƒªãƒ¼ã‚«ãƒ¼ãƒ‰ */
        .summary-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .summary-card {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            text-align: center;
        }

        .summary-card .number {
            font-size: 2rem;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .summary-card .label {
            color: #666;
            font-size: 14px;
        }

        .summary-card.alert {
            border-left: 4px solid #e74c3c;
        }

        .summary-card.warning {
            border-left: 4px solid #f39c12;
        }

        .summary-card.success {
            border-left: 4px solid #27ae60;
        }

        .summary-card.info {
            border-left: 4px solid #3498db;
        }

        /* ãƒ‡ãƒ¼ã‚¿ãƒ†ãƒ¼ãƒ–ãƒ« */
        .data-panel {
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .panel-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .panel-title {
            font-size: 1.3rem;
            font-weight: bold;
            color: #2c3e50;
        }

        .filter-controls {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .search-box {
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 5px;
            width: 200px;
        }

        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
        }

        .data-table th,
        .data-table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #eee;
        }

        .data-table th {
            background: #f8f9fa;
            font-weight: bold;
            color: #2c3e50;
        }

        .data-table tr:hover {
            background: #f8f9fa;
        }

        /* ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãƒãƒƒã‚¸ */
        .status-badge {
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: bold;
            text-transform: uppercase;
        }

        .status-normal {
            background: #d4edda;
            color: #155724;
        }

        .status-warning {
            background: #fff3cd;
            color: #856404;
        }

        .status-danger {
            background: #f8d7da;
            color: #721c24;
        }

        .status-ordered {
            background: #cce5ff;
            color: #0056b3;
        }

        .status-on-hold {
            background: #ffeaa7;
            color: #b8860b;
        }

        .status-uploaded {
            background: #d4edda;
            color: #155724;
        }

        .status-error {
            background: #f8d7da;
            color: #721c24;
        }

        /* æ•°å€¤ã‚«ãƒ©ãƒ¼ */
        .number-positive {
            color: #27ae60;
            font-weight: bold;
        }

        .number-negative {
            color: #e74c3c;
            font-weight: bold;
        }

        .number-neutral {
            color: #333;
        }

        /* å•†å“ã‚³ãƒ¼ãƒ‰è¡¨ç¤º */
        .product-code {
            font-family: 'Consolas', 'Monaco', 'Lucida Console', monospace;
            background: #e8f4f8;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 13px;
            font-weight: 600;
            color: #2c3e50;
            border: 1px solid #bce8f1;
            cursor: pointer;
            transition: all 0.3s;
            white-space: nowrap;
        }

        .product-code:hover {
            background: #d1ecf1;
            border-color: #85d4e3;
        }

        .product-name-container {
            display: flex;
            align-items: center;
            flex-wrap: wrap;
        }

        .product-name {
            flex: 1;
            min-width: 200px;
        }

        .product-code-column {
            width: 100px;
            text-align: center;
            cursor: pointer;
            position: relative;
        }

        .category-column {
            width: 120px;
            cursor: pointer;
            position: relative;
        }

        .sortable-header {
            cursor: pointer;
            position: relative;
            user-select: none;
        }

        .sortable-header:hover {
            background-color: #e8f4f8;
        }

        .sort-indicator {
            position: absolute;
            right: 5px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 12px;
            color: #666;
        }

        .sort-asc::after {
            content: "â†‘";
        }

        .sort-desc::after {
            content: "â†“";
        }

        .stock-column {
            width: 80px;
            text-align: center;
        }

        .reorder-point-column {
            width: 80px;
            text-align: center;
        }

        .shortage-column {
            width: 80px;
            text-align: center;
        }

        .daily-average-column {
            width: 100px;
            text-align: center;
        }

        .status-input {
            width: 80px;
            padding: 2px 4px;
            border: 1px solid #ddd;
            border-radius: 3px;
            font-size: 11px;
            background: white;
        }

        .status-input:focus {
            outline: none;
            border-color: #3498db;
        }

        .status-editable {
            cursor: pointer;
            transition: background-color 0.3s;
        }

        .status-column {
            width: 100px;
            text-align: center;
        }

        .status-input {
            width: 80px;
            padding: 2px 4px;
            border: 1px solid #ddd;
            border-radius: 3px;
            font-size: 11px;
            background: white;
        }

        .status-input:focus {
            outline: none;
            border-color: #3498db;
        }

        .status-editable {
            cursor: pointer;
            transition: all 0.3s;
            position: relative;
            padding: 4px 8px;
            border-radius: 12px;
            background: #cce5ff;
            color: #0056b3;
            border: 1px dashed #0056b3;
        }

        .status-editable:hover {
            background-color: #b3d9ff;
            border-color: #004085;
        }

        .status-editable::after {
            content: "âœï¸";
            position: absolute;
            right: -15px;
            top: 2px;
            font-size: 10px;
            opacity: 0.7;
        }

        .status-editable:hover::after {
            opacity: 1;
        }

        .order-date-column {
            width: 100px;
            text-align: center;
        }

        .delivery-date-column {
            width: 100px;
            text-align: center;
        }

        .quantity-column {
            width: 80px;
            text-align: center;
        }

        .copy-notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #27ae60;
            color: white;
            padding: 10px 20px;
            border-radius: 5px;
            z-index: 1000;
            opacity: 0;
            transform: translateY(-20px);
            transition: all 0.3s ease;
        }

        .copy-notification.show {
            opacity: 1;
            transform: translateY(0);
        }

        /* ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ– */
        @media (max-width: 768px) {
            .settings-grid {
                grid-template-columns: 1fr;
            }
            
            .summary-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .filter-controls {
                flex-direction: column;
                gap: 10px;
            }
            
            .search-box {
                width: 100%;
            }
        }

        /* ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚° */
        .loading {
            text-align: center;
            padding: 40px;
            color: #666;
        }

        .loading-spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #3498db;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* ã‚¿ãƒ– */
        .tab-container {
            margin-bottom: 20px;
        }

        .tab-buttons {
            display: flex;
            border-bottom: 2px solid #eee;
            align-items: center;
        }

        .tab-button {
            padding: 10px 20px;
            background: none;
            border: none;
            cursor: pointer;
            font-size: 14px;
            color: #666;
            border-bottom: 2px solid transparent;
            transition: all 0.3s;
        }

        .tab-button.active {
            color: #3498db;
            border-bottom-color: #3498db;
        }

        .tab-copy-btn {
            background: #9b59b6;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 12px;
            margin-left: auto;
            transition: background 0.3s;
        }

        .tab-copy-btn:hover {
            background: #8e44ad;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        /* ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰é–¢é€£ã‚¹ã‚¿ã‚¤ãƒ« */
        .upload-section {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }

        .upload-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .upload-group label {
            font-weight: bold;
            color: #2c3e50;
        }

        .upload-group input[type="file"] {
            padding: 10px;
            border: 2px dashed #ddd;
            border-radius: 5px;
            background: #f9f9f9;
            cursor: pointer;
            transition: border-color 0.3s;
        }

        .upload-group input[type="file"]:hover {
            border-color: #3498db;
        }

        .upload-group small {
            color: #666;
            font-size: 12px;
        }

        .upload-status {
            display: flex;
            justify-content: space-between;
            background: #f8f9fa;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 20px;
        }

        .status-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 5px;
        }

        .current-settings {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 20px;
        }

        .current-settings h4 {
            margin-bottom: 10px;
            color: #2c3e50;
        }

        .btn-sm {
            padding: 5px 10px;
            font-size: 12px;
        }

        .checkbox-column {
            width: 40px;
            text-align: center;
        }

        .action-column {
            width: 140px;
            text-align: center;
        }

        .action-column .btn-sm {
            margin: 0 2px;
            padding: 4px 8px;
            font-size: 11px;
        }

        .item-checkbox {
            width: 18px;
            height: 18px;
            cursor: pointer;
        }

        .selected-count {
            color: #3498db;
            font-weight: bold;
        }

        .table-controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 5px;
        }

        .selection-controls {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .action-controls {
            display: flex;
            gap: 10px;
        }

        /* æ‰‹å‹•è¿½åŠ ãƒ¢ãƒ¼ãƒ€ãƒ« */
        .add-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
        }

        .add-modal-content {
            background: white;
            margin: 10% auto;
            padding: 0;
            border-radius: 10px;
            max-width: 500px;
            position: relative;
        }

        .add-modal-header {
            background: linear-gradient(135deg, #27ae60, #2ecc71);
            color: white;
            padding: 20px;
            border-radius: 10px 10px 0 0;
            margin: 0;
        }

        .add-modal-body {
            padding: 20px;
        }

        .add-form-group {
            margin-bottom: 15px;
        }

        .add-form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: #2c3e50;
        }

        .add-form-group input,
        .add-form-group select {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 14px;
        }

        .add-form-group input:focus,
        .add-form-group select:focus {
            outline: none;
            border-color: #27ae60;
        }

        .required {
            color: #e74c3c;
        }

        .add-form-group small {
            color: #666;
            font-size: 12px;
            margin-top: 5px;
            display: block;
        }

        .add-modal-footer {
            display: flex;
            justify-content: space-between;
            padding: 20px;
            border-top: 1px solid #eee;
            gap: 10px;
        }

        .btn-add {
            background: #27ae60;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 12px;
            transition: background 0.3s;
        }

        .btn-add:hover {
            background: #219a52;
        }

        @media (max-width: 768px) {
            .upload-section {
                grid-template-columns: 1fr;
            }
            
            .upload-status {
                flex-direction: column;
                gap: 10px;
            }
        }
    </style>
</head>
<body>
    <header class="header">
        <div class="header-content">
            <div class="logo">ğŸ“Š åœ¨åº«ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ </div>
            <div class="user-info">
                <span id="lastUpdate">æœ€çµ‚æ›´æ–°: --:--</span>
                <button class="btn" onclick="refreshData()">ğŸ”„ æ›´æ–°</button>
            </div>
        </div>
    </header>

    <div class="container">
        <!-- ã‚¯ã‚¤ãƒƒã‚¯ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãƒ‘ãƒãƒ« -->
        <div class="settings-panel">
            <h3>ğŸ“ ãƒ‡ãƒ¼ã‚¿ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰</h3>
            <div class="upload-section">
                <div class="upload-group">
                    <label for="inventoryFile">ğŸ“¦ å•†å“ãƒ‡ãƒ¼ã‚¿CSV</label>
                    <input type="file" id="inventoryFile" accept=".csv" onchange="handleInventoryFileUpload(event)">
                    <small>ã‚¹ãƒãƒ¬ã‚¸ã®å•†å“ãƒ‡ãƒ¼ã‚¿CSVãƒ•ã‚¡ã‚¤ãƒ«</small>
                </div>
                <div class="upload-group">
                    <label for="salesFile">ğŸ“Š åœ¨åº«å±¥æ­´é›†è¨ˆCSV</label>
                    <input type="file" id="salesFile" accept=".csv" onchange="handleSalesFileUpload(event)">
                    <small>ã‚¹ãƒãƒ¬ã‚¸ã®åœ¨åº«å±¥æ­´é›†è¨ˆCSVãƒ•ã‚¡ã‚¤ãƒ«</small>
                </div>
            </div>
            <div class="upload-status">
                <div class="status-item">
                    <span>å•†å“ãƒ‡ãƒ¼ã‚¿:</span>
                    <span id="inventoryStatus" class="status-badge status-normal">æœªã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰</span>
                </div>
                <div class="status-item">
                    <span>åœ¨åº«å±¥æ­´é›†è¨ˆ:</span>
                    <span id="salesStatus" class="status-badge status-normal">æœªã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰</span>
                </div>
            </div>
            <div class="current-settings">
                <h4>âš™ï¸ ç¾åœ¨ã®è¨­å®š</h4>
                <div style="font-size: 14px; color: #666; line-height: 1.4;">
                    <span id="currentSettings">åˆ†ææœŸé–“: 2é€±é–“ | ç™ºæ³¨ç‚¹: æ—¥å¹³å‡å‡ºè·æ•° Ã— 37æ—¥</span>
                </div>
                <div style="font-size: 14px; color: #666; margin-top: 5px;">
                    <span id="lastCalculation">æœ€çµ‚è¨ˆç®—: æœªå®Ÿè¡Œ</span>
                </div>
            </div>
            <div style="display: flex; gap: 10px; margin-top: 15px;">
                <button class="btn btn-success" onclick="calculateReorderPoints()" id="calculateBtn">ğŸ“Š ç™ºæ³¨ç‚¹ã‚’è¨ˆç®—</button>
                <button class="btn" onclick="downloadSampleCSV()">ğŸ“¥ ã‚µãƒ³ãƒ—ãƒ«CSVãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰</button>
                <button class="btn btn-danger" onclick="clearAllData()">ğŸ—‘ï¸ å…¨ãƒ‡ãƒ¼ã‚¿å‰Šé™¤</button>
            </div>
        </div>

        <!-- ã‚µãƒãƒªãƒ¼ã‚«ãƒ¼ãƒ‰ -->
        <div class="summary-grid">
            <div class="summary-card alert">
                <div class="number" id="urgentCount">0</div>
                <div class="label">ç™ºæ³¨å¿…è¦</div>
            </div>
            <div class="summary-card info">
                <div class="number" id="orderedCount">0</div>
                <div class="label">ç™ºæ³¨ä¸­</div>
            </div>
            <div class="summary-card warning">
                <div class="number" id="onHoldCount">0</div>
                <div class="label">ç™ºæ³¨åœæ­¢ä¸­</div>
            </div>
            <div class="summary-card success">
                <div class="number" id="normalCount">0</div>
                <div class="label">åœ¨åº«æ­£å¸¸</div>
            </div>
        </div>

        <!-- ãƒ‡ãƒ¼ã‚¿ãƒ‘ãƒãƒ« -->
        <div class="data-panel">
            <div class="tab-container">
                <div class="tab-buttons">
                    <button class="tab-button active" onclick="showTab('reorder')">ğŸš¨ ç™ºæ³¨å¿…è¦</button>
                    <button class="tab-button" onclick="showTab('ordered')">ğŸ“‹ ç™ºæ³¨ä¸­</button>
                    <button class="tab-button" onclick="showTab('onhold')">â¸ï¸ ç™ºæ³¨åœæ­¢ä¸­</button>
                    <button class="tab-button" onclick="showTab('all')">ğŸ“Š å…¨å•†å“</button>
                    <button class="tab-copy-btn" onclick="copyAllCurrentTabCodes()" id="tabCopyBtn">å…¨å“ç•ªã‚³ãƒ”ãƒ¼</button>
                </div>
            </div>

            <div class="panel-header">
                <h3 class="panel-title" id="currentTabTitle">ç™ºæ³¨ãŒå¿…è¦ãªå•†å“</h3>
                <div class="filter-controls">
                    <input type="text" class="search-box" placeholder="å•†å“åã§æ¤œç´¢..." onkeyup="filterTable()">
                    <select onchange="filterByCategory()" id="categoryFilter">
                        <option value="">å…¨åº—èˆ—</option>
                    </select>
                </div>
            </div>

            <!-- ç™ºæ³¨å¿…è¦ã‚¿ãƒ– -->
            <div id="reorder-tab" class="tab-content active">
                <div class="table-controls">
                    <div class="selection-controls">
                        <label>
                            <input type="checkbox" id="selectAllReorder" onchange="toggleSelectAllReorder()">
                            å…¨é¸æŠ
                        </label>
                        <span class="selected-count" id="reorderSelectedCount">0ä»¶é¸æŠ</span>
                    </div>
                    <div class="action-controls">
                        <button class="btn btn-success btn-sm" onclick="moveSelectedToOrdered()" id="moveToOrderedBtn" disabled>é¸æŠå•†å“ã‚’ç™ºæ³¨ä¸­ã«ç§»å‹•</button>
                    </div>
                </div>
                
                <table class="data-table">
                    <thead>
                        <tr>
                            <th class="checkbox-column">é¸æŠ</th>
                            <th class="product-code-column sortable-header" onclick="sortTable('productCode')">
                                å•†å“ã‚³ãƒ¼ãƒ‰
                                <span class="sort-indicator" id="sort-productCode"></span>
                            </th>
                            <th>å•†å“å</th>
                            <th class="category-column sortable-header" onclick="sortTable('store')">
                                åº—èˆ—
                                <span class="sort-indicator" id="sort-store"></span>
                            </th>
                            <th class="stock-column">ç¾åœ¨åœ¨åº«</th>
                            <th class="reorder-point-column">ç™ºæ³¨ç‚¹</th>
                            <th class="shortage-column">ä¸è¶³æ•°</th>
                            <th class="daily-average-column">æ—¥å¹³å‡è²©å£²</th>
                            <th class="status-column">å„ªå…ˆåº¦</th>
                            <th class="action-column">å€‹åˆ¥æ“ä½œ</th>
                        </tr>
                    </thead>
                    <tbody id="reorderTableBody">
                        <tr>
                            <td colspan="10" class="loading">ãƒ‡ãƒ¼ã‚¿ã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ã¦ãã ã•ã„</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <!-- ç™ºæ³¨ä¸­ã‚¿ãƒ– -->
            <div id="ordered-tab" class="tab-content">
                <div class="table-controls">
                    <div class="selection-controls">
                        <label>
                            <input type="checkbox" id="selectAllOrdered" onchange="toggleSelectAllOrdered()">
                            å…¨é¸æŠ
                        </label>
                        <span class="selected-count" id="orderedSelectedCount">0ä»¶é¸æŠ</span>
                    </div>
                    <div class="action-controls">
                        <button class="btn btn-add btn-sm" onclick="showAddOrderModal()">â• æ‰‹å‹•è¿½åŠ </button>
                        <button class="btn btn-success btn-sm" onclick="completeSelectedOrders()" id="completeOrdersBtn" disabled>é¸æŠå•†å“ã‚’å…¥è·å®Œäº†</button>
                        <button class="btn btn-danger btn-sm" onclick="deleteSelectedOrders()" id="deleteOrdersBtn" disabled>é¸æŠå•†å“ã‚’å‰Šé™¤</button>
                    </div>
                </div>
                
                <table class="data-table">
                    <thead>
                        <tr>
                            <th class="checkbox-column">é¸æŠ</th>
                            <th class="product-code-column sortable-header" onclick="sortTable('productCode')">
                                å•†å“ã‚³ãƒ¼ãƒ‰
                                <span class="sort-indicator" id="sort-productCode"></span>
                            </th>
                            <th>å•†å“å</th>
                            <th class="category-column sortable-header" onclick="sortTable('store')">
                                åº—èˆ—
                                <span class="sort-indicator" id="sort-store"></span>
                            </th>
                            <th class="stock-column">ç¾åœ¨åœ¨åº«</th>
                            <th class="quantity-column">ç™ºæ³¨æ•°</th>
                            <th class="order-date-column">ç™ºæ³¨æ—¥</th>
                            <th class="delivery-date-column">äºˆå®šç´æœŸ</th>
                            <th class="status-column">ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹</th>
                            <th class="action-column">å€‹åˆ¥æ“ä½œ</th>
                        </tr>
                    </thead>
                    <tbody id="orderedTableBody">
                        <tr>
                            <td colspan="10" class="loading">ç™ºæ³¨ä¸­ã®å•†å“ã¯ã‚ã‚Šã¾ã›ã‚“</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <!-- ç™ºæ³¨åœæ­¢ä¸­ã‚¿ãƒ– -->
            <div id="onhold-tab" class="tab-content">
                <div class="table-controls">
                    <div class="selection-controls">
                        <label>
                            <input type="checkbox" id="selectAllOnHold" onchange="toggleSelectAllOnHold()">
                            å…¨é¸æŠ
                        </label>
                        <span class="selected-count" id="onHoldSelectedCount">0ä»¶é¸æŠ</span>
                    </div>
                    <div class="action-controls">
                        <button class="btn btn-success btn-sm" onclick="resumeSelectedOrders()" id="resumeOrdersBtn" disabled>é¸æŠå•†å“ã‚’ç™ºæ³¨å†é–‹</button>
                        <button class="btn btn-danger btn-sm" onclick="deleteSelectedOnHold()" id="deleteOnHoldBtn" disabled>é¸æŠå•†å“ã‚’å‰Šé™¤</button>
                    </div>
                </div>
                
                <table class="data-table">
                    <thead>
                        <tr>
                            <th class="checkbox-column">é¸æŠ</th>
                            <th class="product-code-column sortable-header" onclick="sortTable('productCode')">
                                å•†å“ã‚³ãƒ¼ãƒ‰
                                <span class="sort-indicator" id="sort-productCode"></span>
                            </th>
                            <th>å•†å“å</th>
                            <th class="category-column sortable-header" onclick="sortTable('store')">
                                åº—èˆ—
                                <span class="sort-indicator" id="sort-store"></span>
                            </th>
                            <th class="stock-column">ç¾åœ¨åœ¨åº«</th>
                            <th class="reorder-point-column">ç™ºæ³¨ç‚¹</th>
                            <th class="order-date-column">åœæ­¢æ—¥</th>
                            <th class="status-column">ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹</th>
                            <th class="action-column">å€‹åˆ¥æ“ä½œ</th>
                        </tr>
                    </thead>
                    <tbody id="onHoldTableBody">
                        <tr>
                            <td colspan="9" class="loading">ç™ºæ³¨åœæ­¢ä¸­ã®å•†å“ã¯ã‚ã‚Šã¾ã›ã‚“</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <!-- å…¨å•†å“ã‚¿ãƒ– -->
            <div id="all-tab" class="tab-content">
                <table class="data-table">
                    <thead>
                        <tr>
                            <th class="product-code-column sortable-header" onclick="sortTable('productCode')">
                                å•†å“ã‚³ãƒ¼ãƒ‰
                                <span class="sort-indicator" id="sort-productCode"></span>
                            </th>
                            <th>å•†å“å</th>
                            <th class="category-column sortable-header" onclick="sortTable('store')">
                                åº—èˆ—
                                <span class="sort-indicator" id="sort-store"></span>
                            </th>
                            <th class="stock-column">ç¾åœ¨åœ¨åº«</th>
                            <th class="reorder-point-column">ç™ºæ³¨ç‚¹</th>
                            <th class="daily-average-column">æ—¥å¹³å‡è²©å£²</th>
                            <th class="status-column">ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹</th>
                            <th class="action-column">æ“ä½œ</th>
                        </tr>
                    </thead>
                    <tbody id="allTableBody">
                        <tr>
                            <td colspan="8" class="loading">ãƒ‡ãƒ¼ã‚¿ã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ã¦ãã ã•ã„</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- æ‰‹å‹•è¿½åŠ ãƒ¢ãƒ¼ãƒ€ãƒ« -->
    <div id="addOrderModal" class="add-modal">
        <div class="add-modal-content">
            <div class="add-modal-header">
                <h2>â• ç™ºæ³¨å•†å“ã‚’æ‰‹å‹•è¿½åŠ </h2>
                <span class="close" onclick="closeAddOrderModal()" style="position: absolute; top: 15px; right: 20px; font-size: 2rem; cursor: pointer;">&times;</span>
            </div>
            <div class="add-modal-body">
                <div class="add-form-group">
                    <label for="addProductCode">å•†å“ã‚³ãƒ¼ãƒ‰ <span class="required">*</span></label>
                    <input type="text" id="addProductCode" placeholder="å•†å“ã‚³ãƒ¼ãƒ‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„" required>
                    <small>å¿…é ˆé …ç›®ã§ã™</small>
                </div>
                <div class="add-form-group">
                    <label for="addProductName">å•†å“å</label>
                    <input type="text" id="addProductName" placeholder="å•†å“åã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ï¼ˆä»»æ„ï¼‰">
                    <small>ç©ºæ¬„ã®å ´åˆã¯ã€Œæ‰‹å‹•è¿½åŠ å•†å“ã€ã¨ã—ã¦ç™»éŒ²ã•ã‚Œã¾ã™</small>
                </div>
                <div class="add-form-group">
                    <label for="addStore">åº—èˆ—</label>
                    <select id="addStore">
                        <option value="">åº—èˆ—ã‚’é¸æŠã—ã¦ãã ã•ã„</option>
                    </select>
                </div>
                <div class="add-form-group">
                    <label for="addOrderQuantity">ç™ºæ³¨æ•°</label>
                    <input type="number" id="addOrderQuantity" placeholder="ç™ºæ³¨æ•°ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„" min="1" value="1">
                </div>
                <div class="add-form-group">
                    <label for="addExpectedDelivery">äºˆå®šç´æœŸ</label>
                    <input type="date" id="addExpectedDelivery">
                </div>
                <div class="add-form-group">
                    <label for="addOrderStatus">ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹</label>
                    <input type="text" id="addOrderStatus" placeholder="ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„" value="ç™ºæ³¨ä¸­">
                </div>
            </div>
            <div class="add-modal-footer">
                <button class="btn" onclick="closeAddOrderModal()">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
                <button class="btn btn-success" onclick="addOrderManually()">è¿½åŠ </button>
            </div>
        </div>
    </div>

    <!-- ã‚³ãƒ”ãƒ¼é€šçŸ¥ -->
    <div id="copyNotification" class="copy-notification">
        ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸï¼
    </div>

    <script>
        // ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°
        let inventoryData = [];
        let orderedItems = [];
        let onHoldItems = [];
        let currentTab = 'reorder';
        let uploadedInventoryData = null;
        let uploadedSalesData = null;
        let selectedReorderItems = new Set();
        let selectedOrderedItems = new Set();
        let selectedOnHoldItems = new Set();
        let currentSettings = {
            analysisWeeks: 2,
            leadTime: 7,
            safetyStock: 3,
            urgentThreshold: 50
        };
        let currentSortColumn = '';
        let currentSortDirection = 'asc';

        // åˆæœŸåŒ–
        document.addEventListener('DOMContentLoaded', function() {
            loadFromLocalStorage();
            updateLastUpdateTime();
            updateSummaryCards();
            updateCategoryFilter();
        });

        // CSVãƒ•ã‚¡ã‚¤ãƒ«å‡¦ç†
        function handleInventoryFileUpload(event) {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    try {
                        const csv = e.target.result;
                        uploadedInventoryData = parseSmaregiInventoryCSV(csv);
                        
                        if (validateInventoryData(uploadedInventoryData)) {
                            document.getElementById('inventoryStatus').textContent = `âœ… ${uploadedInventoryData.length}ä»¶èª­ã¿è¾¼ã¿`;
                            document.getElementById('inventoryStatus').className = 'status-badge status-uploaded';
                            showNotification('å•†å“ãƒ‡ãƒ¼ã‚¿CSVãŒæ­£å¸¸ã«èª­ã¿è¾¼ã¾ã‚Œã¾ã—ãŸ');
                        } else {
                            throw new Error('ãƒ‡ãƒ¼ã‚¿å½¢å¼ãŒæ­£ã—ãã‚ã‚Šã¾ã›ã‚“');
                        }
                    } catch (error) {
                        document.getElementById('inventoryStatus').textContent = `âŒ ã‚¨ãƒ©ãƒ¼: ${error.message}`;
                        document.getElementById('inventoryStatus').className = 'status-badge status-error';
                        uploadedInventoryData = null;
                        showNotification('CSVãƒ•ã‚¡ã‚¤ãƒ«ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ: ' + error.message, 'error');
                    }
                };
                reader.readAsText(file, 'shift_jis');
            }
        }

        function handleSalesFileUpload(event) {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    try {
                        const csv = e.target.result;
                        uploadedSalesData = parseSmaregiSalesCSV(csv);
                        
                        if (validateSalesData(uploadedSalesData)) {
                            document.getElementById('salesStatus').textContent = `âœ… ${uploadedSalesData.length}ä»¶èª­ã¿è¾¼ã¿`;
                            document.getElementById('salesStatus').className = 'status-badge status-uploaded';
                            showNotification('åœ¨åº«å±¥æ­´é›†è¨ˆCSVãŒæ­£å¸¸ã«èª­ã¿è¾¼ã¾ã‚Œã¾ã—ãŸ');
                        } else {
                            throw new Error('ãƒ‡ãƒ¼ã‚¿å½¢å¼ãŒæ­£ã—ãã‚ã‚Šã¾ã›ã‚“');
                        }
                    } catch (error) {
                        document.getElementById('salesStatus').textContent = `âŒ ã‚¨ãƒ©ãƒ¼: ${error.message}`;
                        document.getElementById('salesStatus').className = 'status-badge status-error';
                        uploadedSalesData = null;
                        showNotification('CSVãƒ•ã‚¡ã‚¤ãƒ«ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ: ' + error.message, 'error');
                    }
                };
                reader.readAsText(file, 'shift_jis');
            }
        }

        // ãƒ‡ãƒ¼ã‚¿ã®ä¿å­˜ãƒ»å¾©å…ƒæ©Ÿèƒ½
        function saveToLocalStorage() {
            const dataToSave = {
                inventoryData: inventoryData,
                orderedItems: orderedItems,
                onHoldItems: onHoldItems,
                currentSettings: currentSettings,
                lastCalculation: document.getElementById('lastCalculation').textContent
            };
            
            try {
                localStorage.setItem('inventoryManagementData', JSON.stringify(dataToSave));
                console.log('ãƒ‡ãƒ¼ã‚¿ã‚’ä¿å­˜ã—ã¾ã—ãŸ');
            } catch (error) {
                console.error('ãƒ‡ãƒ¼ã‚¿ã®ä¿å­˜ã«å¤±æ•—ã—ã¾ã—ãŸ:', error);
            }
        }

        function loadFromLocalStorage() {
            try {
                const savedData = localStorage.getItem('inventoryManagementData');
                if (savedData) {
                    const data = JSON.parse(savedData);
                    
                    inventoryData = data.inventoryData || [];
                    orderedItems = data.orderedItems || [];
                    onHoldItems = data.onHoldItems || [];
                    currentSettings = { ...currentSettings, ...data.currentSettings };
                    
                    if (data.lastCalculation) {
                        document.getElementById('lastCalculation').textContent = data.lastCalculation;
                    }
                    
                    updateSummaryCards();
                    updateTables();
                    updateCategoryFilter();
                    
                    console.log('ãƒ‡ãƒ¼ã‚¿ã‚’å¾©å…ƒã—ã¾ã—ãŸ');
                    showNotification('å‰å›ã®ãƒ‡ãƒ¼ã‚¿ã‚’å¾©å…ƒã—ã¾ã—ãŸ');
                } else {
                    console.log('ä¿å­˜ã•ã‚ŒãŸãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“');
                }
            } catch (error) {
                console.error('ãƒ‡ãƒ¼ã‚¿ã®å¾©å…ƒã«å¤±æ•—ã—ã¾ã—ãŸ:', error);
                showNotification('ãƒ‡ãƒ¼ã‚¿ã®å¾©å…ƒã«å¤±æ•—ã—ã¾ã—ãŸ', 'error');
            }
        }

        // ãƒ‡ãƒ¼ã‚¿ã®ä¿å­˜ãƒ»å¾©å…ƒæ©Ÿèƒ½
        function saveToLocalStorage() {
            const dataToSave = {
                inventoryData: inventoryData,
                orderedItems: orderedItems,
                onHoldItems: onHoldItems,
                currentSettings: currentSettings,
                lastCalculation: document.getElementById('lastCalculation').textContent
            };
            
            try {
                localStorage.setItem('inventoryManagementData', JSON.stringify(dataToSave));
                console.log('ãƒ‡ãƒ¼ã‚¿ã‚’ä¿å­˜ã—ã¾ã—ãŸ');
            } catch (error) {
                console.error('ãƒ‡ãƒ¼ã‚¿ã®ä¿å­˜ã«å¤±æ•—ã—ã¾ã—ãŸ:', error);
            }
        }

        function loadFromLocalStorage() {
            try {
                const savedData = localStorage.getItem('inventoryManagementData');
                if (savedData) {
                    const data = JSON.parse(savedData);
                    
                    inventoryData = data.inventoryData || [];
                    orderedItems = data.orderedItems || [];
                    onHoldItems = data.onHoldItems || [];
                    currentSettings = { ...currentSettings, ...data.currentSettings };
                    
                    if (data.lastCalculation) {
                        document.getElementById('lastCalculation').textContent = data.lastCalculation;
                    }
                    
                    updateSummaryCards();
                    updateTables();
                    updateCategoryFilter();
                    
                    console.log('ãƒ‡ãƒ¼ã‚¿ã‚’å¾©å…ƒã—ã¾ã—ãŸ');
                    showNotification('å‰å›ã®ãƒ‡ãƒ¼ã‚¿ã‚’å¾©å…ƒã—ã¾ã—ãŸ');
                } else {
                    console.log('ä¿å­˜ã•ã‚ŒãŸãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“');
                }
            } catch (error) {
                console.error('ãƒ‡ãƒ¼ã‚¿ã®å¾©å…ƒã«å¤±æ•—ã—ã¾ã—ãŸ:', error);
                showNotification('ãƒ‡ãƒ¼ã‚¿ã®å¾©å…ƒã«å¤±æ•—ã—ã¾ã—ãŸ', 'error');
            }
        }

        function clearLocalStorage() {
            try {
                localStorage.removeItem('inventoryManagementData');
                console.log('ä¿å­˜ã•ã‚ŒãŸãƒ‡ãƒ¼ã‚¿ã‚’å‰Šé™¤ã—ã¾ã—ãŸ');
                showNotification('ä¿å­˜ã•ã‚ŒãŸãƒ‡ãƒ¼ã‚¿ã‚’å‰Šé™¤ã—ã¾ã—ãŸ');
            } catch (error) {
                console.error('ãƒ‡ãƒ¼ã‚¿ã®å‰Šé™¤ã«å¤±æ•—ã—ã¾ã—ãŸ:', error);
            }
        }

        // CSVè§£æé–¢æ•°
        function parseSmaregiInventoryCSV(csvText) {
            const lines = csvText.split('\n');
            const data = [];

            for (let i = 1; i < lines.length; i++) {
                const line = lines[i].trim();
                if (line && line.length > 0) {
                    const columns = parseCSVLine(line);
                    
                    if (columns.length >= 16) {
                        const productCode = columns[2] || '';
                        const department = columns[3] || '';
                        const productName = columns[5] || '';
                        const currentStock = parseInt(columns[15]) || 0;
                        
                        if (productCode && productName) {
                            data.push({
                                productId: productCode,
                                productName: productName,
                                category: department || 'æœªè¨­å®š',
                                currentStock: currentStock,
                                supplier: 'æœªè¨­å®š',
                                unitCost: 0
                            });
                        }
                    }
                }
            }
            return data;
        }

        function parseSmaregiSalesCSV(csvText) {
            const lines = csvText.split('\n');
            const data = [];

            for (let i = 1; i < lines.length; i++) {
                const line = lines[i].trim();
                if (line && line.length > 0) {
                    const columns = parseCSVLine(line);
                    
                    if (columns.length >= 11) {
                        const productCode = columns[2] || '';
                        const salesQuantity = parseInt(columns[10]) || 0;
                        
                        if (productCode && salesQuantity > 0) {
                            data.push({
                                productId: productCode,
                                saleDate: new Date().toISOString().split('T')[0],
                                quantity: salesQuantity,
                                unitPrice: 0
                            });
                        }
                    }
                }
            }
            return data;
        }

        function parseCSVLine(line) {
            const result = [];
            let current = '';
            let inQuotes = false;
            
            for (let i = 0; i < line.length; i++) {
                const char = line[i];
                
                if (char === '"') {
                    inQuotes = !inQuotes;
                } else if (char === ',' && !inQuotes) {
                    result.push(current);
                    current = '';
                } else {
                    current += char;
                }
            }
            
            result.push(current);
            return result;
        }

        function validateInventoryData(data) {
            if (!data || data.length === 0) return false;
            const requiredFields = ['productId', 'productName', 'currentStock'];
            return data.every(row => 
                requiredFields.every(field => 
                    row[field] !== undefined && row[field] !== ''
                )
            );
        }

        function validateSalesData(data) {
            if (!data || data.length === 0) return false;
            const requiredFields = ['productId', 'quantity'];
            return data.every(row => 
                requiredFields.every(field => 
                    row[field] !== undefined && row[field] !== ''
                )
            );
        }

        function calculateReorderPoints() {
            if (!uploadedInventoryData || !uploadedSalesData) {
                alert('å•†å“ãƒ‡ãƒ¼ã‚¿ã¨åœ¨åº«å±¥æ­´é›†è¨ˆãƒ‡ãƒ¼ã‚¿ã®ä¸¡æ–¹ã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ã¦ãã ã•ã„ã€‚');
                return;
            }

            const analysisWeeks = currentSettings.analysisWeeks;
            const analysisDays = analysisWeeks * 7;
            const reorderCalculationDays = 37;

            const salesMap = new Map();
            uploadedSalesData.forEach(sale => {
                const productId = sale.productId;
                const quantity = parseInt(sale.quantity) || 0;
                if (salesMap.has(productId)) {
                    salesMap.set(productId, salesMap.get(productId) + quantity);
                } else {
                    salesMap.set(productId, quantity);
                }
            });

            // ç™ºæ³¨ç‚¹è¨ˆç®—æ™‚ã«æ‰‹å‹•è¿½åŠ ã‚¢ã‚¤ãƒ†ãƒ ã‚’é™¤å¤–ã—ã¦é‡è¤‡ãƒã‚§ãƒƒã‚¯
            const calculatedData = uploadedInventoryData.map(item => {
                const productId = item.productId;
                const currentStock = parseInt(item.currentStock) || 0;
                const totalSales = salesMap.get(productId) || 0;
                const dailyAverage = totalSales / analysisDays;
                const reorderPoint = Math.ceil(dailyAverage * reorderCalculationDays);
                
                // ç™ºæ³¨ä¸­ã¨ç™ºæ³¨åœæ­¢ä¸­ã®ã‚¢ã‚¤ãƒ†ãƒ ã‚’ãƒã‚§ãƒƒã‚¯ï¼ˆæ‰‹å‹•è¿½åŠ ã¯é™¤å¤–ï¼‰
                const isOrdered = orderedItems.some(orderedItem => 
                    orderedItem.id === productId && !orderedItem.isManuallyAdded
                );
                const isOnHold = onHoldItems.some(onHoldItem => onHoldItem.id === productId);
                
                // ç™ºæ³¨ä¸­ã¾ãŸã¯ç™ºæ³¨åœæ­¢ä¸­ã®å ´åˆã¯ç™ºæ³¨ä¸è¦ã¨ã™ã‚‹
                const needsReorder = !isOrdered && !isOnHold && currentStock < reorderPoint;
                const shortage = needsReorder ? Math.max(0, reorderPoint - currentStock) : 0;
                
                let status = 'normal';
                if (needsReorder) {
                    const shortageRatio = shortage / reorderPoint;
                    if (shortageRatio >= 0.5) {
                        status = 'danger';
                    } else {
                        status = 'warning';
                    }
                }

                return {
                    id: productId,
                    name: item.productName,
                    category: item.category || 'æœªè¨­å®š',
                    currentStock: currentStock,
                    totalSales: totalSales,
                    dailyAverage: Math.round(dailyAverage * 100) / 100,
                    reorderPoint: reorderPoint,
                    shortage: shortage,
                    status: status,
                    needsReorder: needsReorder,
                    leadTime: currentSettings.leadTime,
                    supplier: item.supplier || 'æœªè¨­å®š'
                };
            });

            inventoryData = calculatedData;
            
            // ç™ºæ³¨ä¸­ã¨ç™ºæ³¨åœæ­¢ä¸­ã®ã‚¢ã‚¤ãƒ†ãƒ ã‹ã‚‰ã€æ–°ã—ã„ãƒ‡ãƒ¼ã‚¿ã«å­˜åœ¨ã—ãªã„ã‚‚ã®ã‚’å‰Šé™¤
            // ãŸã ã—ã€æ‰‹å‹•è¿½åŠ ã‚¢ã‚¤ãƒ†ãƒ ã¯ä¿æŒã™ã‚‹
            const currentProductIds = new Set(calculatedData.map(item => item.id));
            orderedItems = orderedItems.filter(item => 
                currentProductIds.has(item.id) || item.isManuallyAdded
            );
            onHoldItems = onHoldItems.filter(item => currentProductIds.has(item.id));
            
            updateSummaryCards();
            updateTables();
            updateCategoryFilter();
            updateLastUpdateTime();
            document.getElementById('lastCalculation').textContent = `æœ€çµ‚è¨ˆç®—: ${new Date().toLocaleString('ja-JP')}`;
            
            // ãƒ‡ãƒ¼ã‚¿ã‚’ä¿å­˜
            saveToLocalStorage();
            
            const reorderCount = calculatedData.filter(item => item.needsReorder).length;
            const dangerCount = calculatedData.filter(item => item.status === 'danger').length;
            const warningCount = calculatedData.filter(item => item.status === 'warning').length;
            
            showNotification(`ç™ºæ³¨ç‚¹è¨ˆç®—ãŒå®Œäº†ã—ã¾ã—ãŸï¼å‡¦ç†ä»¶æ•°: ${calculatedData.length}ä»¶ã€ç™ºæ³¨å¿…è¦: ${reorderCount}ä»¶`);
        }

        function refreshData() {
            updateLastUpdateTime();
            showNotification('ãƒ‡ãƒ¼ã‚¿ã‚’æ›´æ–°ã—ã¾ã—ãŸ');
        }

        function updateLastUpdateTime() {
            const now = new Date();
            const timeString = now.toLocaleTimeString('ja-JP', { hour: '2-digit', minute: '2-digit' });
            document.getElementById('lastUpdate').textContent = `æœ€çµ‚æ›´æ–°: ${timeString}`;
        }

        function updateSummaryCards() {
            // ç™ºæ³¨ä¸­ã¨ç™ºæ³¨åœæ­¢ä¸­ã®å•†å“IDã‚’å–å¾—
            const orderedIds = new Set(orderedItems.map(item => item.id));
            const onHoldIds = new Set(onHoldItems.map(item => item.id));
            
            // ç™ºæ³¨å¿…è¦å•†å“ã‹ã‚‰ç™ºæ³¨ä¸­ã¨ç™ºæ³¨åœæ­¢ä¸­ã®å•†å“ã‚’é™¤å¤–
            const urgentCount = inventoryData.filter(item => 
                item.needsReorder && !orderedIds.has(item.id) && !onHoldIds.has(item.id)
            ).length;
            
            const orderedCount = orderedItems.length;
            const onHoldCount = onHoldItems.length;
            const normalCount = inventoryData.filter(item => item.status === 'normal').length;

            document.getElementById('urgentCount').textContent = urgentCount;
            document.getElementById('orderedCount').textContent = orderedCount;
            document.getElementById('onHoldCount').textContent = onHoldCount;
            document.getElementById('normalCount').textContent = normalCount;
        }

        function updateTables() {
            updateReorderTable();
            updateOrderedTable();
            updateOnHoldTable();
            updateAllTable();
        }

        function updateReorderTable() {
            const tbody = document.getElementById('reorderTableBody');
            // ç™ºæ³¨ä¸­ã¨ç™ºæ³¨åœæ­¢ä¸­ã®å•†å“IDã‚’å–å¾—
            const orderedIds = new Set(orderedItems.map(item => item.id));
            const onHoldIds = new Set(onHoldItems.map(item => item.id));
            
            // ç™ºæ³¨å¿…è¦å•†å“ã‹ã‚‰ç™ºæ³¨ä¸­ã¨ç™ºæ³¨åœæ­¢ä¸­ã®å•†å“ã‚’é™¤å¤–
            const reorderItems = inventoryData.filter(item => 
                item.needsReorder && !orderedIds.has(item.id) && !onHoldIds.has(item.id)
            );
            
            selectedReorderItems.clear();
            updateReorderSelection();
            
            if (reorderItems.length === 0) {
                tbody.innerHTML = '<tr><td colspan="10" class="loading">ç™ºæ³¨ãŒå¿…è¦ãªå•†å“ã¯ã‚ã‚Šã¾ã›ã‚“</td></tr>';
                return;
            }

            tbody.innerHTML = reorderItems.map(item => `
                <tr>
                    <td class="checkbox-column">
                        <input type="checkbox" class="item-checkbox" data-id="${item.id}" onchange="toggleReorderItemSelection('${item.id}')">
                    </td>
                    <td class="product-code-column">
                        <span class="product-code" onclick="copyToClipboard('${item.id}')" title="ã‚¯ãƒªãƒƒã‚¯ã§ã‚³ãƒ”ãƒ¼">${item.id}</span>
                    </td>
                    <td>
                        <span class="product-name">${item.name}</span>
                    </td>
                    <td class="category-column">${item.category}</td>
                    <td class="stock-column"><span class="number-${item.currentStock <= 5 ? 'negative' : 'neutral'}">${item.currentStock}</span></td>
                    <td class="reorder-point-column">${item.reorderPoint}</td>
                    <td class="shortage-column"><span class="number-negative">${item.shortage}</span></td>
                    <td class="daily-average-column">${item.dailyAverage}</td>
                    <td class="status-column"><span class="status-badge status-${item.status}">${getPriorityText(item.status)}</span></td>
                    <td class="action-column">
                        <button class="btn btn-success btn-sm" onclick="markSingleAsOrdered('${item.id}')">ç™ºæ³¨</button>
                        <button class="btn btn-warning btn-sm" onclick="markAsOnHold('${item.id}')">åœæ­¢</button>
                    </td>
                </tr>
            `).join('');
        }

        function updateOrderedTable() {
            const tbody = document.getElementById('orderedTableBody');
            
            selectedOrderedItems.clear();
            updateOrderedSelection();
            
            if (orderedItems.length === 0) {
                tbody.innerHTML = '<tr><td colspan="10" class="loading">ç™ºæ³¨ä¸­ã®å•†å“ã¯ã‚ã‚Šã¾ã›ã‚“</td></tr>';
                return;
            }

            tbody.innerHTML = orderedItems.map(item => `
                <tr>
                    <td class="checkbox-column">
                        <input type="checkbox" class="item-checkbox" data-id="${item.id}" onchange="toggleOrderedItemSelection('${item.id}')">
                    </td>
                    <td class="product-code-column">
                        <span class="product-code" onclick="copyToClipboard('${item.id}')" title="ã‚¯ãƒªãƒƒã‚¯ã§ã‚³ãƒ”ãƒ¼">${item.id}</span>
                    </td>
                    <td>
                        <span class="product-name">${item.name}</span>
                    </td>
                    <td class="category-column">${item.category}</td>
                    <td class="stock-column">${item.currentStock}</td>
                    <td class="quantity-column">${item.orderedQuantity}</td>
                    <td class="order-date-column">${item.orderDate}</td>
                    <td class="delivery-date-column">${item.expectedDelivery}</td>
                    <td class="status-column">
                        <span class="status-badge status-editable" onclick="editOrderStatus('${item.id}', this)" title="ã‚¯ãƒªãƒƒã‚¯ã§ç·¨é›†">
                            ${item.orderStatus || 'ç™ºæ³¨ä¸­'}
                        </span>
                    </td>
                    <td class="action-column">
                        <button class="btn btn-success btn-sm" onclick="completeOrder('${item.id}')">å®Œäº†</button>
                        <button class="btn btn-danger btn-sm" onclick="cancelOrder('${item.id}')">å‰Šé™¤</button>
                    </td>
                </tr>
            `).join('');
        }

        function updateOnHoldTable() {
            const tbody = document.getElementById('onHoldTableBody');
            
            selectedOnHoldItems.clear();
            updateOnHoldSelection();
            
            if (onHoldItems.length === 0) {
                tbody.innerHTML = '<tr><td colspan="9" class="loading">ç™ºæ³¨åœæ­¢ä¸­ã®å•†å“ã¯ã‚ã‚Šã¾ã›ã‚“</td></tr>';
                return;
            }

            tbody.innerHTML = onHoldItems.map(item => `
                <tr>
                    <td class="checkbox-column">
                        <input type="checkbox" class="item-checkbox" data-id="${item.id}" onchange="toggleOnHoldItemSelection('${item.id}')">
                    </td>
                    <td class="product-code-column">
                        <span class="product-code" onclick="copyToClipboard('${item.id}')" title="ã‚¯ãƒªãƒƒã‚¯ã§ã‚³ãƒ”ãƒ¼">${item.id}</span>
                    </td>
                    <td>
                        <span class="product-name">${item.name}</span>
                    </td>
                    <td class="category-column">${item.category}</td>
                    <td class="stock-column">${item.currentStock}</td>
                    <td class="reorder-point-column">${item.reorderPoint}</td>
                    <td class="order-date-column">${item.onHoldDate}</td>
                    <td class="status-column"><span class="status-badge status-on-hold">åœæ­¢ä¸­</span></td>
                    <td class="action-column">
                        <button class="btn btn-success btn-sm" onclick="resumeOrder('${item.id}')">å†é–‹</button>
                        <button class="btn btn-danger btn-sm" onclick="deleteOnHoldItem('${item.id}')">å‰Šé™¤</button>
                    </td>
                </tr>
            `).join('');
        }

        function updateAllTable() {
            const tbody = document.getElementById('allTableBody');
            
            if (inventoryData.length === 0) {
                tbody.innerHTML = '<tr><td colspan="8" class="loading">ãƒ‡ãƒ¼ã‚¿ã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ã¦ãã ã•ã„</td></tr>';
                return;
            }

            tbody.innerHTML = inventoryData.map(item => `
                <tr>
                    <td class="product-code-column">
                        <span class="product-code" onclick="copyToClipboard('${item.id}')" title="ã‚¯ãƒªãƒƒã‚¯ã§ã‚³ãƒ”ãƒ¼">${item.id}</span>
                    </td>
                    <td>
                        <span class="product-name">${item.name}</span>
                    </td>
                    <td class="category-column">${item.category}</td>
                    <td class="stock-column"><span class="number-${item.currentStock <= 5 ? 'negative' : 'neutral'}">${item.currentStock}</span></td>
                    <td class="reorder-point-column">${item.reorderPoint}</td>
                    <td class="daily-average-column">${item.dailyAverage}</td>
                    <td class="status-column"><span class="status-badge status-${item.status}">${getStatusText(item.status)}</span></td>
                    <td class="action-column">
                        ${item.needsReorder ? 
                            '<button class="btn btn-success btn-sm" onclick="markSingleAsOrdered(\'' + item.id + '\')">ç™ºæ³¨</button>' : 
                            '<span style="color: #999;">æ­£å¸¸</span>'
                        }
                    </td>
                </tr>
            `).join('');
        }

        function updateCategoryFilter() {
            const select = document.getElementById('categoryFilter');
            const categories = [...new Set(inventoryData.map(item => item.category))];
            
            select.innerHTML = '<option value="">å…¨åº—èˆ—</option>' + 
                categories.map(category => `<option value="${category}">${category}</option>`).join('');
        }

        // ã‚½ãƒ¼ãƒˆæ©Ÿèƒ½
        function sortTable(column) {
            // ç¾åœ¨ã®ã‚½ãƒ¼ãƒˆçŠ¶æ…‹ã‚’æ›´æ–°
            if (currentSortColumn === column) {
                currentSortDirection = currentSortDirection === 'asc' ? 'desc' : 'asc';
            } else {
                currentSortColumn = column;
                currentSortDirection = 'asc';
            }
            
            // ã‚½ãƒ¼ãƒˆã‚¤ãƒ³ã‚¸ã‚±ãƒ¼ã‚¿ãƒ¼ã‚’æ›´æ–°
            updateSortIndicators();
            
            // ç¾åœ¨ã®ã‚¿ãƒ–ã«å¿œã˜ã¦ã‚½ãƒ¼ãƒˆ
            sortCurrentTabData();
            
            // ãƒ†ãƒ¼ãƒ–ãƒ«ã‚’æ›´æ–°
            updateTables();
        }

        function updateSortIndicators() {
            // å…¨ã¦ã®ã‚½ãƒ¼ãƒˆã‚¤ãƒ³ã‚¸ã‚±ãƒ¼ã‚¿ãƒ¼ã‚’ã‚¯ãƒªã‚¢
            document.querySelectorAll('.sort-indicator').forEach(indicator => {
                indicator.className = 'sort-indicator';
            });
            
            // ç¾åœ¨ã®ã‚½ãƒ¼ãƒˆåˆ—ã®ã‚¤ãƒ³ã‚¸ã‚±ãƒ¼ã‚¿ãƒ¼ã‚’æ›´æ–°
            if (currentSortColumn) {
                const indicators = document.querySelectorAll(`#sort-${currentSortColumn}`);
                indicators.forEach(indicator => {
                    indicator.className = `sort-indicator sort-${currentSortDirection}`;
                });
            }
        }

        function sortCurrentTabData() {
            const sortFunction = getSortFunction(currentSortColumn, currentSortDirection);
            
            // å„ãƒ‡ãƒ¼ã‚¿é…åˆ—ã‚’ã‚½ãƒ¼ãƒˆ
            inventoryData.sort(sortFunction);
            orderedItems.sort(sortFunction);
            onHoldItems.sort(sortFunction);
        }

        // ã‚½ãƒ¼ãƒˆæ©Ÿèƒ½
        function sortTable(column) {
            // ç¾åœ¨ã®ã‚½ãƒ¼ãƒˆçŠ¶æ…‹ã‚’æ›´æ–°
            if (currentSortColumn === column) {
                currentSortDirection = currentSortDirection === 'asc' ? 'desc' : 'asc';
            } else {
                currentSortColumn = column;
                currentSortDirection = 'asc';
            }
            
            // ã‚½ãƒ¼ãƒˆã‚¤ãƒ³ã‚¸ã‚±ãƒ¼ã‚¿ãƒ¼ã‚’æ›´æ–°
            updateSortIndicators();
            
            // ç¾åœ¨ã®ã‚¿ãƒ–ã«å¿œã˜ã¦ã‚½ãƒ¼ãƒˆ
            sortCurrentTabData();
            
            // ãƒ†ãƒ¼ãƒ–ãƒ«ã‚’æ›´æ–°
            updateTables();
        }

        function updateSortIndicators() {
            // å…¨ã¦ã®ã‚½ãƒ¼ãƒˆã‚¤ãƒ³ã‚¸ã‚±ãƒ¼ã‚¿ãƒ¼ã‚’ã‚¯ãƒªã‚¢
            document.querySelectorAll('.sort-indicator').forEach(indicator => {
                indicator.className = 'sort-indicator';
            });
            
            // ç¾åœ¨ã®ã‚½ãƒ¼ãƒˆåˆ—ã®ã‚¤ãƒ³ã‚¸ã‚±ãƒ¼ã‚¿ãƒ¼ã‚’æ›´æ–°
            if (currentSortColumn) {
                const indicators = document.querySelectorAll(`#sort-${currentSortColumn}`);
                indicators.forEach(indicator => {
                    indicator.className = `sort-indicator sort-${currentSortDirection}`;
                });
            }
        }

        function sortCurrentTabData() {
            const sortFunction = getSortFunction(currentSortColumn, currentSortDirection);
            
            // å„ãƒ‡ãƒ¼ã‚¿é…åˆ—ã‚’ã‚½ãƒ¼ãƒˆ
            inventoryData.sort(sortFunction);
            orderedItems.sort(sortFunction);
            onHoldItems.sort(sortFunction);
        }

        function getSortFunction(column, direction) {
            return function(a, b) {
                let valueA, valueB;
                
                switch (column) {
                    case 'productCode':
                        valueA = a.id || '';
                        valueB = b.id || '';
                        break;
                    case 'store':
                        valueA = a.category || '';
                        valueB = b.category || '';
                        break;
                    default:
                        return 0;
                }
                
                // æ–‡å­—åˆ—æ¯”è¼ƒ
                if (direction === 'asc') {
                    return valueA.localeCompare(valueB);
                } else {
                    return valueB.localeCompare(valueA);
                }
            };
        }

        function showTab(tabName) {
            const tabs = document.querySelectorAll('.tab-content');
            const buttons = document.querySelectorAll('.tab-button');
            
            tabs.forEach(tab => tab.classList.remove('active'));
            buttons.forEach(button => button.classList.remove('active'));
            
            document.getElementById(tabName + '-tab').classList.add('active');
            event.target.classList.add('active');
            
            currentTab = tabName;
            
            // ã‚½ãƒ¼ãƒˆã‚¤ãƒ³ã‚¸ã‚±ãƒ¼ã‚¿ãƒ¼ã‚’æ›´æ–°ï¼ˆã‚¿ãƒ–åˆ‡ã‚Šæ›¿ãˆæ™‚ï¼‰
            updateSortIndicators();
            
            const titles = {
                'reorder': 'ç™ºæ³¨ãŒå¿…è¦ãªå•†å“',
                'ordered': 'ç™ºæ³¨ä¸­ã®å•†å“',
                'onhold': 'ç™ºæ³¨åœæ­¢ä¸­ã®å•†å“',
                'all': 'å…¨å•†å“'
            };
            
            document.getElementById('currentTabTitle').textContent = titles[tabName];
        }

        function filterTable() {
            const searchTerm = document.querySelector('.search-box').value.toLowerCase();
            const categoryFilter = document.getElementById('categoryFilter').value;
            const rows = document.querySelectorAll(`#${currentTab}-tab .data-table tbody tr`);
            
            rows.forEach(row => {
                const productName = row.querySelector('.product-name');
                const categoryCell = currentTab === 'all' ? 
                    row.cells[2] : // å…¨å•†å“ã‚¿ãƒ–ã§ã¯åº—èˆ—ã¯3ç•ªç›®
                    row.cells[3];   // ä»–ã®ã‚¿ãƒ–ã§ã¯åº—èˆ—ã¯4ç•ªç›®
                
                if (productName && categoryCell) {
                    const nameMatch = productName.textContent.toLowerCase().includes(searchTerm);
                    const categoryMatch = !categoryFilter || categoryCell.textContent === categoryFilter;
                    
                    row.style.display = (nameMatch && categoryMatch) ? '' : 'none';
                }
            });
        }

        function filterByCategory() {
            filterTable();
        }

        function getPriorityText(status) {
            const statusMap = {
                'danger': 'ç·Šæ€¥',
                'warning': 'æ³¨æ„',
                'normal': 'æ­£å¸¸'
            };
            return statusMap[status] || 'ä¸æ˜';
        }

        function getStatusText(status) {
            const statusMap = {
                'danger': 'ç™ºæ³¨å¿…è¦',
                'warning': 'ç™ºæ³¨æ¨å¥¨',
                'normal': 'æ­£å¸¸'
            };
            return statusMap[status] || 'ä¸æ˜';
        }

        function copyToClipboard(text) {
            navigator.clipboard.writeText(text).then(() => {
                showNotification('ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸ: ' + text);
            }).catch(err => {
                console.error('ã‚³ãƒ”ãƒ¼ã«å¤±æ•—ã—ã¾ã—ãŸ:', err);
                showNotification('ã‚³ãƒ”ãƒ¼ã«å¤±æ•—ã—ã¾ã—ãŸ', 'error');
            });
        }

        function copyAllCurrentTabCodes() {
            let codes = [];
            
            // ç™ºæ³¨ä¸­ã¨ç™ºæ³¨åœæ­¢ä¸­ã®å•†å“IDã‚’å–å¾—
            const orderedIds = new Set(orderedItems.map(item => item.id));
            const onHoldIds = new Set(onHoldItems.map(item => item.id));
            
            switch (currentTab) {
                case 'reorder':
                    codes = inventoryData.filter(item => 
                        item.needsReorder && !orderedIds.has(item.id) && !onHoldIds.has(item.id)
                    ).map(item => item.id);
                    break;
                case 'ordered':
                    codes = orderedItems.map(item => item.id);
                    break;
                case 'onhold':
                    codes = onHoldItems.map(item => item.id);
                    break;
                case 'all':
                    codes = inventoryData.map(item => item.id);
                    break;
            }
            
            if (codes.length > 0) {
                const codeText = codes.join('\n');
                navigator.clipboard.writeText(codeText).then(() => {
                    showNotification(`${codes.length}ä»¶ã®å“ç•ªã‚’ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸ`);
                }).catch(err => {
                    console.error('ã‚³ãƒ”ãƒ¼ã«å¤±æ•—ã—ã¾ã—ãŸ:', err);
                    showNotification('ã‚³ãƒ”ãƒ¼ã«å¤±æ•—ã—ã¾ã—ãŸ', 'error');
                });
            } else {
                showNotification('ã‚³ãƒ”ãƒ¼ã™ã‚‹å“ç•ªãŒã‚ã‚Šã¾ã›ã‚“');
            }
        }

        function showNotification(message, type = 'success') {
            const notification = document.getElementById('copyNotification');
            notification.textContent = message;
            notification.className = `copy-notification ${type === 'error' ? 'error' : ''}`;
            notification.classList.add('show');
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, 3000);
        }

        function downloadSampleCSV() {
            const sampleData = `å•†å“ã‚³ãƒ¼ãƒ‰,å•†å“å,åº—èˆ—,åœ¨åº«æ•°
P001,ãƒãƒ¼ãƒˆPC Acer Aspire,æ±äº¬åº—,3
P002,ãƒ—ãƒªãƒ³ã‚¿ç”¨ç´™ A4 500æš,å¤§é˜ªåº—,5
P003,ãƒã‚¦ã‚¹ ç„¡ç·š,åå¤å±‹åº—,10`;
            
            const blob = new Blob([sampleData], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = 'sample_inventory.csv';
            link.click();
            URL.revokeObjectURL(link.href);
        }

        function clearAllData() {
            if (confirm('å…¨ã¦ã®ãƒ‡ãƒ¼ã‚¿ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿã“ã®æ“ä½œã¯å–ã‚Šæ¶ˆã›ã¾ã›ã‚“ã€‚')) {
                // ãƒ‡ãƒ¼ã‚¿ã‚’åˆæœŸåŒ–
                inventoryData = [];
                orderedItems = [];
                onHoldItems = [];
                selectedReorderItems.clear();
                selectedOrderedItems.clear();
                selectedOnHoldItems.clear();
                
                // ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‹ã‚‰ã‚‚å‰Šé™¤
                clearLocalStorage();
                
                // ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚’ãƒªã‚»ãƒƒãƒˆ
                document.getElementById('inventoryStatus').textContent = 'æœªã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰';
                document.getElementById('inventoryStatus').className = 'status-badge status-normal';
                document.getElementById('salesStatus').textContent = 'æœªã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰';
                document.getElementById('salesStatus').className = 'status-badge status-normal';
                document.getElementById('lastCalculation').textContent = 'æœ€çµ‚è¨ˆç®—: æœªå®Ÿè¡Œ';
                
                // ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ãƒ‡ãƒ¼ã‚¿ã‚‚ãƒªã‚»ãƒƒãƒˆ
                uploadedInventoryData = null;
                uploadedSalesData = null;
                
                // ãƒ•ã‚¡ã‚¤ãƒ«å…¥åŠ›ã‚‚ãƒªã‚»ãƒƒãƒˆ
                document.getElementById('inventoryFile').value = '';
                document.getElementById('salesFile').value = '';
                
                // ç”»é¢ã‚’æ›´æ–°
                updateSummaryCards();
                updateTables();
                updateCategoryFilter();
                
                showNotification('å…¨ã¦ã®ãƒ‡ãƒ¼ã‚¿ã‚’å‰Šé™¤ã—ã¾ã—ãŸ');
            }
        }

        // é¸æŠæ©Ÿèƒ½
        function toggleReorderItemSelection(itemId) {
            if (selectedReorderItems.has(itemId)) {
                selectedReorderItems.delete(itemId);
            } else {
                selectedReorderItems.add(itemId);
            }
            updateReorderSelection();
        }

        function toggleOrderedItemSelection(itemId) {
            if (selectedOrderedItems.has(itemId)) {
                selectedOrderedItems.delete(itemId);
            } else {
                selectedOrderedItems.add(itemId);
            }
            updateOrderedSelection();
        }

        function toggleOnHoldItemSelection(itemId) {
            if (selectedOnHoldItems.has(itemId)) {
                selectedOnHoldItems.delete(itemId);
            } else {
                selectedOnHoldItems.add(itemId);
            }
            updateOnHoldSelection();
        }

        function toggleSelectAllReorder() {
            const checkboxes = document.querySelectorAll('#reorder-tab .item-checkbox');
            const selectAll = document.getElementById('selectAllReorder');
            
            if (selectAll.checked) {
                checkboxes.forEach(cb => {
                    cb.checked = true;
                    selectedReorderItems.add(cb.dataset.id);
                });
            } else {
                checkboxes.forEach(cb => {
                    cb.checked = false;
                    selectedReorderItems.delete(cb.dataset.id);
                });
            }
            updateReorderSelection();
        }

        function toggleSelectAllOrdered() {
            const checkboxes = document.querySelectorAll('#ordered-tab .item-checkbox');
            const selectAll = document.getElementById('selectAllOrdered');
            
            if (selectAll.checked) {
                checkboxes.forEach(cb => {
                    cb.checked = true;
                    selectedOrderedItems.add(cb.dataset.id);
                });
            } else {
                checkboxes.forEach(cb => {
                    cb.checked = false;
                    selectedOrderedItems.delete(cb.dataset.id);
                });
            }
            updateOrderedSelection();
        }

        function toggleSelectAllOnHold() {
            const checkboxes = document.querySelectorAll('#onhold-tab .item-checkbox');
            const selectAll = document.getElementById('selectAllOnHold');
            
            if (selectAll.checked) {
                checkboxes.forEach(cb => {
                    cb.checked = true;
                    selectedOnHoldItems.add(cb.dataset.id);
                });
            } else {
                checkboxes.forEach(cb => {
                    cb.checked = false;
                    selectedOnHoldItems.delete(cb.dataset.id);
                });
            }
            updateOnHoldSelection();
        }

        function updateReorderSelection() {
            document.getElementById('reorderSelectedCount').textContent = `${selectedReorderItems.size}ä»¶é¸æŠ`;
            document.getElementById('moveToOrderedBtn').disabled = selectedReorderItems.size === 0;
        }

        function updateOrderedSelection() {
            document.getElementById('orderedSelectedCount').textContent = `${selectedOrderedItems.size}ä»¶é¸æŠ`;
            document.getElementById('completeOrdersBtn').disabled = selectedOrderedItems.size === 0;
            document.getElementById('deleteOrdersBtn').disabled = selectedOrderedItems.size === 0;
        }

        function updateOnHoldSelection() {
            document.getElementById('onHoldSelectedCount').textContent = `${selectedOnHoldItems.size}ä»¶é¸æŠ`;
            document.getElementById('resumeOrdersBtn').disabled = selectedOnHoldItems.size === 0;
            document.getElementById('deleteOnHoldBtn').disabled = selectedOnHoldItems.size === 0;
        }

        // æ‰‹å‹•è¿½åŠ ãƒ¢ãƒ¼ãƒ€ãƒ«æ©Ÿèƒ½
        function showAddOrderModal() {
            // åº—èˆ—ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’è¨­å®š
            populateStoreOptions();
            
            // äºˆå®šç´æœŸã‚’ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã§è¨­å®šï¼ˆ7æ—¥å¾Œï¼‰
            const deliveryDate = new Date();
            deliveryDate.setDate(deliveryDate.getDate() + 7);
            document.getElementById('addExpectedDelivery').value = deliveryDate.toISOString().split('T')[0];
            
            // ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’è¡¨ç¤º
            document.getElementById('addOrderModal').style.display = 'block';
            
            // å•†å“ã‚³ãƒ¼ãƒ‰ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã«ãƒ•ã‚©ãƒ¼ã‚«ã‚¹
            setTimeout(() => {
                document.getElementById('addProductCode').focus();
            }, 100);
        }

        function closeAddOrderModal() {
            document.getElementById('addOrderModal').style.display = 'none';
            
            // ãƒ•ã‚©ãƒ¼ãƒ ã‚’ãƒªã‚»ãƒƒãƒˆ
            document.getElementById('addProductCode').value = '';
            document.getElementById('addProductName').value = '';
            document.getElementById('addStore').value = '';
            document.getElementById('addOrderQuantity').value = '1';
            document.getElementById('addOrderStatus').value = 'ç™ºæ³¨ä¸­';
        }

        function populateStoreOptions() {
            const storeSelect = document.getElementById('addStore');
            const stores = [...new Set(inventoryData.map(item => item.category))];
            
            storeSelect.innerHTML = '<option value="">åº—èˆ—ã‚’é¸æŠã—ã¦ãã ã•ã„</option>' + 
                stores.map(store => `<option value="${store}">${store}</option>`).join('');
        }

        function addOrderManually() {
            const productCode = document.getElementById('addProductCode').value.trim();
            const productName = document.getElementById('addProductName').value.trim() || 'æ‰‹å‹•è¿½åŠ å•†å“';
            const store = document.getElementById('addStore').value || 'æœªè¨­å®š';
            const orderQuantity = parseInt(document.getElementById('addOrderQuantity').value) || 1;
            const expectedDelivery = document.getElementById('addExpectedDelivery').value;
            const orderStatus = document.getElementById('addOrderStatus').value.trim() || 'ç™ºæ³¨ä¸­';
            
            // å•†å“ã‚³ãƒ¼ãƒ‰ã¯å¿…é ˆ
            if (!productCode) {
                alert('å•†å“ã‚³ãƒ¼ãƒ‰ã¯å¿…é ˆé …ç›®ã§ã™ã€‚');
                document.getElementById('addProductCode').focus();
                return;
            }
            
            // é‡è¤‡ãƒã‚§ãƒƒã‚¯
            const isDuplicate = orderedItems.some(item => item.id === productCode);
            if (isDuplicate) {
                alert('ã“ã®å•†å“ã‚³ãƒ¼ãƒ‰ã¯æ—¢ã«ç™ºæ³¨ä¸­ãƒªã‚¹ãƒˆã«å­˜åœ¨ã—ã¾ã™ã€‚');
                document.getElementById('addProductCode').focus();
                return;
            }
            
            // ç™ºæ³¨ã‚¢ã‚¤ãƒ†ãƒ ã‚’è¿½åŠ 
            const today = new Date();
            const newOrderItem = {
                id: productCode,
                name: productName,
                category: store,
                currentStock: 0, // æ‰‹å‹•è¿½åŠ ã®ãŸã‚ä¸æ˜
                orderedQuantity: orderQuantity,
                orderDate: today.toISOString().split('T')[0],
                expectedDelivery: expectedDelivery || today.toISOString().split('T')[0],
                status: 'ordered',
                orderStatus: orderStatus,
                supplier: 'æ‰‹å‹•è¿½åŠ ',
                isManuallyAdded: true // æ‰‹å‹•è¿½åŠ ãƒ•ãƒ©ã‚°
            };
            
            orderedItems.push(newOrderItem);
            
            // ãƒ‡ãƒ¼ã‚¿ã‚’ä¿å­˜
            saveToLocalStorage();
            
            // ç”»é¢ã‚’æ›´æ–°
            updateSummaryCards();
            updateTables();
            
            // ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’é–‰ã˜ã‚‹
            closeAddOrderModal();
            
            // é€šçŸ¥ã‚’è¡¨ç¤º
            showNotification(`å•†å“ã‚³ãƒ¼ãƒ‰ã€Œ${productCode}ã€ã‚’ç™ºæ³¨ä¸­ã«è¿½åŠ ã—ã¾ã—ãŸ`);
        }

        // æ‰‹å‹•è¿½åŠ ãƒ¢ãƒ¼ãƒ€ãƒ«æ©Ÿèƒ½
        function showAddOrderModal() {
            // åº—èˆ—ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’è¨­å®š
            populateStoreOptions();
            
            // äºˆå®šç´æœŸã‚’ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã§è¨­å®šï¼ˆ7æ—¥å¾Œï¼‰
            const deliveryDate = new Date();
            deliveryDate.setDate(deliveryDate.getDate() + 7);
            document.getElementById('addExpectedDelivery').value = deliveryDate.toISOString().split('T')[0];
            
            // ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’è¡¨ç¤º
            document.getElementById('addOrderModal').style.display = 'block';
            
            // å•†å“ã‚³ãƒ¼ãƒ‰ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã«ãƒ•ã‚©ãƒ¼ã‚«ã‚¹
            setTimeout(() => {
                document.getElementById('addProductCode').focus();
            }, 100);
        }

        function closeAddOrderModal() {
            document.getElementById('addOrderModal').style.display = 'none';
            
            // ãƒ•ã‚©ãƒ¼ãƒ ã‚’ãƒªã‚»ãƒƒãƒˆ
            document.getElementById('addProductCode').value = '';
            document.getElementById('addProductName').value = '';
            document.getElementById('addStore').value = '';
            document.getElementById('addOrderQuantity').value = '1';
            document.getElementById('addOrderStatus').value = 'ç™ºæ³¨ä¸­';
        }

        function populateStoreOptions() {
            const storeSelect = document.getElementById('addStore');
            const stores = [...new Set(inventoryData.map(item => item.category))];
            
            storeSelect.innerHTML = '<option value="">åº—èˆ—ã‚’é¸æŠã—ã¦ãã ã•ã„</option>' + 
                stores.map(store => `<option value="${store}">${store}</option>`).join('');
        }

        function addOrderManually() {
            const productCode = document.getElementById('addProductCode').value.trim();
            const productName = document.getElementById('addProductName').value.trim() || 'æ‰‹å‹•è¿½åŠ å•†å“';
            const store = document.getElementById('addStore').value || 'æœªè¨­å®š';
            const orderQuantity = parseInt(document.getElementById('addOrderQuantity').value) || 1;
            const expectedDelivery = document.getElementById('addExpectedDelivery').value;
            const orderStatus = document.getElementById('addOrderStatus').value.trim() || 'ç™ºæ³¨ä¸­';
            
            // å•†å“ã‚³ãƒ¼ãƒ‰ã¯å¿…é ˆ
            if (!productCode) {
                alert('å•†å“ã‚³ãƒ¼ãƒ‰ã¯å¿…é ˆé …ç›®ã§ã™ã€‚');
                document.getElementById('addProductCode').focus();
                return;
            }
            
            // é‡è¤‡ãƒã‚§ãƒƒã‚¯
            const isDuplicate = orderedItems.some(item => item.id === productCode);
            if (isDuplicate) {
                alert('ã“ã®å•†å“ã‚³ãƒ¼ãƒ‰ã¯æ—¢ã«ç™ºæ³¨ä¸­ãƒªã‚¹ãƒˆã«å­˜åœ¨ã—ã¾ã™ã€‚');
                document.getElementById('addProductCode').focus();
                return;
            }
            
            // ç™ºæ³¨ã‚¢ã‚¤ãƒ†ãƒ ã‚’è¿½åŠ 
            const today = new Date();
            const newOrderItem = {
                id: productCode,
                name: productName,
                category: store,
                currentStock: 0, // æ‰‹å‹•è¿½åŠ ã®ãŸã‚ä¸æ˜
                orderedQuantity: orderQuantity,
                orderDate: today.toISOString().split('T')[0],
                expectedDelivery: expectedDelivery || today.toISOString().split('T')[0],
                status: 'ordered',
                orderStatus: orderStatus,
                supplier: 'æ‰‹å‹•è¿½åŠ ',
                isManuallyAdded: true // æ‰‹å‹•è¿½åŠ ãƒ•ãƒ©ã‚°
            };
            
            orderedItems.push(newOrderItem);
            
            // ãƒ‡ãƒ¼ã‚¿ã‚’ä¿å­˜
            saveToLocalStorage();
            
            // ç”»é¢ã‚’æ›´æ–°
            updateSummaryCards();
            updateTables();
            
            // ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’é–‰ã˜ã‚‹
            closeAddOrderModal();
            
            // é€šçŸ¥ã‚’è¡¨ç¤º
            showNotification(`å•†å“ã‚³ãƒ¼ãƒ‰ã€Œ${productCode}ã€ã‚’ç™ºæ³¨ä¸­ã«è¿½åŠ ã—ã¾ã—ãŸ`);
        }

        // ãƒ¢ãƒ¼ãƒ€ãƒ«å¤–ã‚¯ãƒªãƒƒã‚¯ã§é–‰ã˜ã‚‹
        window.onclick = function(event) {
            const addModal = document.getElementById('addOrderModal');
            if (event.target == addModal) {
                closeAddOrderModal();
            }
        };

        // ç™ºæ³¨ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ç·¨é›†æ©Ÿèƒ½
        // ç™ºæ³¨ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ç·¨é›†æ©Ÿèƒ½
        function editOrderStatus(itemId, element) {
            const currentStatus = element.textContent.trim();
            const input = document.createElement('input');
            input.type = 'text';
            input.className = 'status-input';
            input.value = currentStatus;
            input.maxLength = 10;
            
            // å…¥åŠ›ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã«ç½®ãæ›ãˆ
            element.innerHTML = '';
            element.appendChild(input);
            input.focus();
            input.select();
            
            // ã‚¨ãƒ³ã‚¿ãƒ¼ã‚­ãƒ¼ã¾ãŸã¯ãƒ•ã‚©ãƒ¼ã‚«ã‚¹ã‚¢ã‚¦ãƒˆã§ä¿å­˜
            const saveStatus = () => {
                const newStatus = input.value.trim();
                if (newStatus) {
                    // ãƒ‡ãƒ¼ã‚¿ã‚’æ›´æ–°
                    const orderItem = orderedItems.find(item => item.id === itemId);
                    if (orderItem) {
                        orderItem.orderStatus = newStatus;
                        saveToLocalStorage();
                        showNotification(`ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚’ "${newStatus}" ã«æ›´æ–°ã—ã¾ã—ãŸ`);
                    }
                    
                    // è¡¨ç¤ºã‚’å…ƒã«æˆ»ã™
                    element.innerHTML = `<span class="status-badge status-editable" onclick="editOrderStatus('${itemId}', this)" title="ã‚¯ãƒªãƒƒã‚¯ã§ç·¨é›†">${newStatus}</span>`;
                } else {
                    // ç©ºã®å ´åˆã¯å…ƒã«æˆ»ã™
                    element.innerHTML = `<span class="status-badge status-editable" onclick="editOrderStatus('${itemId}', this)" title="ã‚¯ãƒªãƒƒã‚¯ã§ç·¨é›†">${currentStatus}</span>`;
                }
            };
            
            input.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    saveStatus();
                }
            });
            
            input.addEventListener('blur', saveStatus);
            
            // ESCã‚­ãƒ¼ã§ã‚­ãƒ£ãƒ³ã‚»ãƒ«
            input.addEventListener('keydown', (e) => {
                if (e.key === 'Escape') {
                    element.innerHTML = `<span class="status-badge status-editable" onclick="editOrderStatus('${itemId}', this)" title="ã‚¯ãƒªãƒƒã‚¯ã§ç·¨é›†">${currentStatus}</span>`;
                }
            });
        }

        // ç™ºæ³¨ç®¡ç†æ©Ÿèƒ½
        function markSingleAsOrdered(itemId) {
            const item = inventoryData.find(i => i.id === itemId);
            if (item) {
                const orderQuantity = prompt(`${item.name}ã®ç™ºæ³¨æ•°ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„:`, item.shortage);
                if (orderQuantity && parseInt(orderQuantity) > 0) {
                    const today = new Date();
                    const deliveryDate = new Date(today);
                    deliveryDate.setDate(today.getDate() + item.leadTime);
                    
                    orderedItems.push({
                        id: item.id,
                        name: item.name,
                        category: item.category,
                        currentStock: item.currentStock,
                        orderedQuantity: parseInt(orderQuantity),
                        orderDate: today.toISOString().split('T')[0],
                        expectedDelivery: deliveryDate.toISOString().split('T')[0],
                        status: 'ordered',
                        orderStatus: 'ç™ºæ³¨ä¸­',
                        supplier: item.supplier
                    });
                    
                    inventoryData = inventoryData.filter(i => i.id !== itemId);
                    updateSummaryCards();
                    updateTables();
                    saveToLocalStorage();
                    showNotification(`${item.name}ã‚’ç™ºæ³¨ä¸­ã«ç§»å‹•ã—ã¾ã—ãŸ`);
                }
            }
        }

        function markAsOnHold(itemId) {
            const item = inventoryData.find(i => i.id === itemId);
            if (item) {
                const reason = prompt(`${item.name}ã®ç™ºæ³¨åœæ­¢ç†ç”±ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„:`, '');
                if (reason !== null) {
                    onHoldItems.push({
                        id: item.id,
                        name: item.name,
                        category: item.category,
                        currentStock: item.currentStock,
                        reorderPoint: item.reorderPoint,
                        onHoldDate: new Date().toISOString().split('T')[0],
                        status: 'on-hold',
                        supplier: item.supplier,
                        reason: reason
                    });
                    
                    inventoryData = inventoryData.filter(i => i.id !== itemId);
                    updateSummaryCards();
                    updateTables();
                    saveToLocalStorage();
                    showNotification(`${item.name}ã‚’ç™ºæ³¨åœæ­¢ä¸­ã«ç§»å‹•ã—ã¾ã—ãŸ`);
                }
            }
        }

        function moveSelectedToOrdered() {
            if (selectedReorderItems.size === 0) return;
            
            const selectedItems = inventoryData.filter(item => selectedReorderItems.has(item.id));
            const orderQuantity = prompt(`é¸æŠã—ãŸ${selectedItems.length}ä»¶ã®ç™ºæ³¨æ•°ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ï¼ˆæ¨å¥¨: ä¸è¶³æ•°ï¼‰:`, '');
            
            if (orderQuantity && parseInt(orderQuantity) > 0) {
                const today = new Date();
                
                selectedItems.forEach(item => {
                    const deliveryDate = new Date(today);
                    deliveryDate.setDate(today.getDate() + item.leadTime);
                    
                    orderedItems.push({
                        id: item.id,
                        name: item.name,
                        category: item.category,
                        currentStock: item.currentStock,
                        orderedQuantity: parseInt(orderQuantity),
                        orderDate: today.toISOString().split('T')[0],
                        expectedDelivery: deliveryDate.toISOString().split('T')[0],
                        status: 'ordered',
                        orderStatus: 'ç™ºæ³¨ä¸­',
                        supplier: item.supplier
                    });
                });
                
                inventoryData = inventoryData.filter(item => !selectedReorderItems.has(item.id));
                selectedReorderItems.clear();
                updateSummaryCards();
                updateTables();
                saveToLocalStorage();
                showNotification(`${selectedItems.length}ä»¶ã‚’ç™ºæ³¨ä¸­ã«ç§»å‹•ã—ã¾ã—ãŸ`);
            }
        }

        function completeSelectedOrders() {
            if (selectedOrderedItems.size === 0) return;
            
            if (confirm(`é¸æŠã—ãŸ${selectedOrderedItems.size}ä»¶ã®ç™ºæ³¨ã‚’å®Œäº†ã—ã¾ã™ã‹ï¼Ÿ`)) {
                orderedItems = orderedItems.filter(item => !selectedOrderedItems.has(item.id));
                selectedOrderedItems.clear();
                updateSummaryCards();
                updateTables();
                saveToLocalStorage();
                showNotification('é¸æŠã—ãŸç™ºæ³¨ã‚’å®Œäº†ã—ã¾ã—ãŸ');
            }
        }

        function deleteSelectedOrders() {
            if (selectedOrderedItems.size === 0) return;
            
            if (confirm(`é¸æŠã—ãŸ${selectedOrderedItems.size}ä»¶ã®ç™ºæ³¨ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ`)) {
                const deletedItems = orderedItems.filter(item => selectedOrderedItems.has(item.id));
                orderedItems = orderedItems.filter(item => !selectedOrderedItems.has(item.id));
                
                deletedItems.forEach(item => {
                    const inventoryItem = {
                        id: item.id,
                        name: item.name,
                        category: item.category,
                        currentStock: item.currentStock,
                        totalSales: 0,
                        dailyAverage: 0,
                        reorderPoint: 0,
                        shortage: 0,
                        status: 'normal',
                        needsReorder: false,
                        leadTime: 7,
                        supplier: item.supplier
                    };
                    inventoryData.push(inventoryItem);
                });
                
                selectedOrderedItems.clear();
                updateSummaryCards();
                updateTables();
                saveToLocalStorage();
                showNotification('é¸æŠã—ãŸç™ºæ³¨ã‚’å‰Šé™¤ã—ã¾ã—ãŸ');
            }
        }

        function resumeSelectedOrders() {
            if (selectedOnHoldItems.size === 0) return;
            
            if (confirm(`é¸æŠã—ãŸ${selectedOnHoldItems.size}ä»¶ã®ç™ºæ³¨ã‚’å†é–‹ã—ã¾ã™ã‹ï¼Ÿ`)) {
                const resumedItems = onHoldItems.filter(item => selectedOnHoldItems.has(item.id));
                onHoldItems = onHoldItems.filter(item => !selectedOnHoldItems.has(item.id));
                
                resumedItems.forEach(item => {
                    const inventoryItem = {
                        id: item.id,
                        name: item.name,
                        category: item.category,
                        currentStock: item.currentStock,
                        totalSales: 0,
                        dailyAverage: 0,
                        reorderPoint: item.reorderPoint,
                        shortage: Math.max(0, item.reorderPoint - item.currentStock),
                        status: 'warning',
                        needsReorder: true,
                        leadTime: 7,
                        supplier: item.supplier
                    };
                    inventoryData.push(inventoryItem);
                });
                
                selectedOnHoldItems.clear();
                updateSummaryCards();
                updateTables();
                saveToLocalStorage();
                showNotification('é¸æŠã—ãŸå•†å“ã®ç™ºæ³¨ã‚’å†é–‹ã—ã¾ã—ãŸ');
            }
        }

        function deleteSelectedOnHold() {
            if (selectedOnHoldItems.size === 0) return;
            
            if (confirm(`é¸æŠã—ãŸ${selectedOnHoldItems.size}ä»¶ã‚’å®Œå…¨ã«å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ`)) {
                onHoldItems = onHoldItems.filter(item => !selectedOnHoldItems.has(item.id));
                selectedOnHoldItems.clear();
                updateSummaryCards();
                updateTables();
                saveToLocalStorage();
                showNotification('é¸æŠã—ãŸå•†å“ã‚’å‰Šé™¤ã—ã¾ã—ãŸ');
            }
        }

        function completeOrder(itemId) {
            const item = orderedItems.find(i => i.id === itemId);
            if (item && confirm(`${item.name}ã®ç™ºæ³¨ã‚’å®Œäº†ã—ã¾ã™ã‹ï¼Ÿ`)) {
                orderedItems = orderedItems.filter(i => i.id !== itemId);
                updateSummaryCards();
                updateTables();
                saveToLocalStorage();
                showNotification(`${item.name}ã®ç™ºæ³¨ã‚’å®Œäº†ã—ã¾ã—ãŸ`);
            }
        }

        function cancelOrder(itemId) {
            const item = orderedItems.find(i => i.id === itemId);
            if (item && confirm(`${item.name}ã®ç™ºæ³¨ã‚’ã‚­ãƒ£ãƒ³ã‚»ãƒ«ã—ã¾ã™ã‹ï¼Ÿ`)) {
                orderedItems = orderedItems.filter(i => i.id !== itemId);
                updateSummaryCards();
                updateTables();
                saveToLocalStorage();
                showNotification(`${item.name}ã®ç™ºæ³¨ã‚’ã‚­ãƒ£ãƒ³ã‚»ãƒ«ã—ã¾ã—ãŸ`);
            }
        }

        function resumeOrder(itemId) {
            const item = onHoldItems.find(i => i.id === itemId);
            if (item && confirm(`${item.name}ã®ç™ºæ³¨ã‚’å†é–‹ã—ã¾ã™ã‹ï¼Ÿ`)) {
                onHoldItems = onHoldItems.filter(i => i.id !== itemId);
                
                const inventoryItem = {
                    id: item.id,
                    name: item.name,
                    category: item.category,
                    currentStock: item.currentStock,
                    totalSales: 0,
                    dailyAverage: 0,
                    reorderPoint: item.reorderPoint,
                    shortage: Math.max(0, item.reorderPoint - item.currentStock),
                    status: 'warning',
                    needsReorder: true,
                    leadTime: 7,
                    supplier: item.supplier
                };
                inventoryData.push(inventoryItem);
                
                updateSummaryCards();
                updateTables();
                saveToLocalStorage();
                showNotification(`${item.name}ã®ç™ºæ³¨ã‚’å†é–‹ã—ã¾ã—ãŸ`);
            }
        }

        function deleteOnHoldItem(itemId) {
            const item = onHoldItems.find(i => i.id === itemId);
            if (item && confirm(`${item.name}ã‚’å®Œå…¨ã«å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ`)) {
                onHoldItems = onHoldItems.filter(i => i.id !== itemId);
                updateSummaryCards();
                updateTables();
                saveToLocalStorage();
                showNotification(`${item.name}ã‚’å‰Šé™¤ã—ã¾ã—ãŸ`);
            }
        }
    </script>
</body>
</html>
